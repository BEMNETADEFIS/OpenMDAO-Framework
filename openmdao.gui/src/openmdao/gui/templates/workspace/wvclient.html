<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title> OpenMDAO Geometry Viewer: {{ geom_name }} </title>

    <link href="/static/css/mdao-styles.css" rel="stylesheet" media="screen">

    <!-- jQuery stuff -->
    <script type="text/javascript" src="/static/js/jquery-1.8.2.min.js"         ></script>
    <script type="text/javascript" src="/static/js/jquery-ui-1.9.1.min.js"      ></script>
    <script type="text/javascript" src="/static/js/jquery.layout-latest.js"     ></script>
    <script type="text/javascript" src="/static/js/jquery.jstree.js"            ></script>
    <script>jQuery.jstree._themes = "/static/css/jstree-themes/";                </script>

    <!--  WebViewer stuff  -->
    <script> var wv = {};           // global namespace for WebViewer            </script>
    <script type="text/javascript" src="/static/js/WebViewer/webgl-utils.js"    ></script>
    <script type="text/javascript" src="/static/js/WebViewer/webgl-debug.js"    ></script>
    <script type="text/javascript" src="/static/js/WebViewer/J3DIMath.js"       ></script>
    <script type="text/javascript" src="/static/js/WebViewer/wv-draw.js"        ></script>
    <script type="text/javascript" src="/static/js/WebViewer/wv-render.js"      ></script>
    <script type="text/javascript" src="/static/js/WebViewer/wv-gPrim.js"       ></script>
    <script type="text/javascript" src="/static/js/WebViewer/wv-sGraph.js"      ></script>
    <script type="text/javascript" src="/static/js/WebViewer/wv-socket.js"      ></script>
    <script type="text/javascript" src="/static/js/WebViewer/wv-tree.js"        ></script>
    <script type="text/javascript" src="/static/js/openmdao/WVTreeFrame.js"     ></script>
    <script type="text/javascript" src="/static/js/openmdao/WVCanvasFrame.js"   ></script>

    <!--  bootstrap  -->
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap.min.js"> </script>
    <link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">

    <!-- styles -->
    <style type="text/css">
        html, body, #leftframe, #riteframe {
            width: 100%;
            height: 100%;
            margin: 0px;
            overflow: hidden;
            background-color: gray;
        }

        #leftframe, #riteframe, #wv_canvas {
            border:1px solid #222;
        }

        #tree {
            width: 100%;
            height: 100%;
            margin: 0px;
            overflow: auto;
            background-color: black;
        }

        #wv_canvas {
            background: url("/static/images/grid_10.png");
        }

        #modal_button {
            position: absolute;
            top: 0px;
            right: 0px;
        }

        .modal-body, th {
            vertical-align: text-top;
        }

        .modal-body, td {
            white-space: nowrap;
        }
    </style>

    <script>
    jQuery(function() {
        // set the layout
        jQuery('body').layout({
            center: {
                paneSelector: '#riteframe'
            },
            west: {
                paneSelector: '#leftframe',
                size: 250
            }
        });

        // our messages have the first NAME_SIZE bytes allocated for a topic name
        wv.NAME_SIZE = window.opener.openmdao.NAME_SIZE;
        wv.MSG_START = wv.NAME_SIZE;

        // have some values for Zscreen
        wv.zNear =  1.0;
        wv.zFar  = 11.0;

        // a place to put the binary messages
        wv.messageQ = [];

        var handleMsg = function(message) {
            // NOTE: the message here is the entire ArrayBuffer containing the
            // padded topic name + the actual message being sent to the WebViewer.
            // This is done so we can avoid copying the buffer.
            wv.messageQ.push(message[1]);
        };

        window.opener.openmdao.project.addListener("{{geom_name}}", handleMsg);

        window.onbeforeunload = function() {
            window.opener.openmdao.project.removeListener("{{geom_name}}");
        };

        // Note: wv requires the canvas name to be "WebViewer"
        var tf = new openmdao.WVTreeFrame(wv, "leftframe");
        var cf = new openmdao.WVCanvasFrame(wv, "WebViewer", "wv_status");

        // wv requires these functions to be in the global namespace
        wvInitUI        = cf.wvInitUI;
        wvUpdateUI      = function() {
            // wv.sgUpdate will be set to 1 if the sceneGraph has changed
            // should be set back to 0 after UI responds
            tf.wvUpdateUI();
            cf.wvUpdateUI();
            wv.sgUpdate = 0;
        }
        wvUpdateCanvas  = cf.wvUpdateCanvas;
        wvUpdateView    = cf.wvUpdateView;
        wvServerMessage = cf.wvServerMessage;
        reshape         = cf.reshape;
        jack            = cf.jack;

        wv.Start();
    });
    </script>
</head>

<body oncontextmenu="return false;">
    <div class="row-fluid">
        <div id='leftframe' class='ui-layout-west'></div>
        <div id='riteframe' class='ui-layout-center'>
            <a id="modal_button" href="#myModal" role="button" class="btn btn-small" data-toggle="modal">
                <i class="icon-info-sign"></i>
            </a>
            <div id="wv_canvas">
                <canvas id="WebViewer">
                    Your web browser doesn't support the &lt;canvas&gt; element.
                </canvas>
            </div>
            <div class="row-fluid">
                <div id="wv_status" class="fps"></div>
            </div>
        </div>

    </div>

    <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
            <h2 id="myModalLabel">Controls</h2>
        </div>
        <div id="modalBody" class="modal-body">
            <table id="controlsTable" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>                       </th>
                        <th>Linux                  </th>
                        <th>OS X                   </th>
                        <th>Windows                </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Pan                    </td>
                        <td>Left Click             </td>
                        <td>Left Click             </td>
                        <td>Left Click             </td>
                    </tr>
                    <tr>
                        <td>X/Y Axis <br> Rotation </td>
                        <td>CTRL + Left Click      </td>
                        <td>CTRL + Left Click      </td>
                        <td>CTRL + Left Click      </td>
                    </tr>
                    <tr>
                        <td>Z Axis   <br> Rotation </td>
                        <td>ALT + Left Click       </td>
                        <td>ALT + Left Click       </td>
                        <td>ALT + Left Click       </td>
                    </tr>
                    <tr>
                        <td>Zoom                   </td>
                        <td>Mouse Wheel            </td>
                        <td>Two Finger Scroll      </td>
                        <td>Mouse Wheel            </td>
                    </tr>
            </table>
        </div>
    </div>
</body>

</html>
